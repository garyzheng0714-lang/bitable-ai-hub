# AI 大模型调用工具 (AIHub)

这是一个为飞书/Lark 多维表格（Basekit）开发的字段捷径插件（FaaS 版），允许用户直接在多维表格中调用主流 AI 大模型。支持自动算费、多模态输入（图片/视频）以及自定义模型调用。

## ✨ 核心特性

- **精选模型支持**：内置 GPT-5.1, Gemini 3 Pro/2.5 Pro/Flash 等核心模型。
- **自定义模型**：支持通过“其他自定义模型”选项灵活调用任意兼容 OpenAI 格式的模型。
- **自动算费**：内置主流模型价格表，自动计算预估花费（支持 USD 自动转 CNY，默认汇率 7.25）。
- **多模态交互**：支持读取表格中的图片和视频附件/链接作为模型输入。
- **深度思考适配**：支持配置深度思考模式（针对支持 `reasoning_effort` 的模型）。

## 🚀 快速开始 (Getting Started)

### 1. 开发环境准备

```bash
# 安装依赖
npm install
```

### 2. 本地调试

```bash
# 启动本地服务器
npm run dev
```

启动后，请使用飞书多维表格的“字段捷径调试助手”连接本地服务进行调试。

### 3. 部署发布

```bash
# 生成发布包
npm run pack
```

运行后将在 `output/` 目录下生成 `output.zip` 文件。请在飞书开发者后台上传此文件进行发布。

## 📝 配置参数说明

在多维表格中添加此字段捷径后，表单配置项如下（按显示顺序）：

| 参数名 | 说明 | 示例 |
| :--- | :--- | :--- |
| **模型名称** | (必填) 选择预设模型或“其他自定义模型”。 | `gpt-5.1`, `gemini-3-pro-preview` |
| **填入自定义模型名称** | (选填) **仅当上方选择“其他自定义模型”时生效**。在此输入具体的模型 ID。 | `my-custom-model-v1` |
| **提示词 (Prompt)** | (必填) 发送给 AI 的指令内容。 | "请总结这段文本..." |
| **请求地址** | (必填) API 接口地址。支持 OpenAI 格式及兼容接口。 | `https://api.openai.com/v1/responses` |
| **Apikey** | (必填) 对应服务商的 API Key。 | `sk-......` |
| **图片内容** | (选填) 选择包含图片链接或附件的字段。 | (选择多维表格字段) |
| **视频内容** | (选填) 选择包含视频链接或附件的字段。 | (选择多维表格字段) |
| **是否进行深度思考** | (选填) 控制推理模型的思考强度。 | `AI 自动判断` / `进行深度思考` |

> **📚 必读教程**：[【FBIF】AI大模型调用工具使用教程](https://foodtalks.feishu.cn/docx/LC6GdsT3uohkyIxvVr8cHT4DnCP)

## 📊 输出结果

插件运行后将返回一个对象（Object），写入到多维表格列中，包含以下属性：

- **输出结果** (`result`)：AI 返回的主要文本内容。
- **思考过程** (`thinking`)：模型的思维链内容（如果模型支持并返回）。
- **预估花费(元)** (`cost`)：根据 Token 用量和内置价格表估算的费用（CNY）。
- **输入 Token** (`input_tokens`)：Prompt 消耗的 Token 数。
- **输出 Token** (`output_tokens`)：Completion 消耗的 Token 数。

## 🤖 内置支持模型列表

代码中已内置以下模型的价格适配：

- **OpenAI Compatible**: `gpt-5.1`
- **Google Gemini**: `gemini-3-pro-preview`, `gemini-2.5-pro`, `gemini-2.5-flash`

*注意：本工具仅作为连接器，实际 API 调用费用由对应的模型服务商收取。*
